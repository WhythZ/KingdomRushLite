#ifndef _ARCHER_HPP_
#define _ARCHER_HPP_

#include "../Tower.hpp"

#define ARCHER_BULLET_SPEED 6

class Archer : public Tower
{
public:
	Archer();
	~Archer() = default;

protected:
	void OnFireBullet() override;        //重写基类中关于子弹发射的逻辑
};

Archer::Archer()
{
	//指定防御塔类型
	type = TowerType::Archer;
	//设置防御塔尺寸
	size.x = 48; size.y = 48;

	#pragma region Bullet
	//设置子弹类型
	bulletType = BulletType::Arrow;
	//设置子弹发射速度
	bulletSpeed = ARCHER_BULLET_SPEED;
	#pragma endregion

	#pragma region Animation
	//获取并设置防御塔的各动画帧图片
	static SDL_Texture* _sprites = ResourceManager::Instance()->GetTexturePool().find(TextureResID::Tower_Archer)->second;
	//根据该纹理资源图片的构造，此处的闲置状态动画第三帧为空，所以要避开类似2、5之类的索引
	static const std::vector<int> _idleUpIdicies = { 3, 4 };
	static const std::vector<int> _idleDownIdicies = { 0, 1 };
	static const std::vector<int> _idleLeftIdicies = { 6, 7 };
	static const std::vector<int> _idleRightIdicies = { 9, 10 };
	static const std::vector<int> _fireUpIdicies = { 15, 16, 17 };
	static const std::vector<int> _fireDownIdicies = { 12, 13, 14 };
	static const std::vector<int> _fireLeftIdicies = { 18, 19, 20 };
	static const std::vector<int> _fireRightIdicies = { 21, 22, 23 };

	animIdleUp.SetAnimFrames(_sprites, 3, 8, _idleUpIdicies);
	animIdleDown.SetAnimFrames(_sprites, 3, 8, _idleDownIdicies);
	animIdleLeft.SetAnimFrames(_sprites, 3, 8, _idleLeftIdicies);
	animIdleRight.SetAnimFrames(_sprites, 3, 8, _idleRightIdicies);
	animFireUp.SetAnimFrames(_sprites, 3, 8, _fireUpIdicies);
	animFireDown.SetAnimFrames(_sprites, 3, 8, _fireDownIdicies);
	animFireLeft.SetAnimFrames(_sprites, 3, 8, _fireLeftIdicies);
	animFireRight.SetAnimFrames(_sprites, 3, 8, _fireRightIdicies);
	#pragma endregion
}

void Archer::OnFireBullet()
{
	Tower::OnFireBullet();

	//播放特定的发射音效
	switch (rand() % 2)
	{
	case 0:
		AudioManager::Instance()->PlaySFX(SoundResID::Arrow_Shoot_1);
		break;
	case 1:
		AudioManager::Instance()->PlaySFX(SoundResID::Arrow_Shoot_2);
		break;
	default:
		break;
	}
}

#endif
